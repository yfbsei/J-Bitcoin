<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>src/encoding/address/decode.js - J-Bitcoin - Bitcoin Wallet Library</title>
    
    <meta name="description" content="JavaScript/TypeScript Bitcoin wallet library with HD wallets, threshold signatures, and BIP compliance" />
    
        <meta name="keywords" content="bitcoin, btc, cryptocurrency, wallet, javascript, typescript, threshold signatures, bip32, bip39" />
        <meta name="keyword" content="bitcoin, btc, cryptocurrency, wallet, javascript, typescript, threshold signatures, bip32, bip39" />
    
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav class="wrap">
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    
    <h2><a href="index.html">Home</a></h2><h2><a href="https://github.com/yfbsei/J-Bitcoin" target="_blank" class="menu-item home-link" id="home-link" >üè† Home</a></h2><h2><a href="https://github.com/yfbsei/J-Bitcoin" target="_blank" class="menu-item github-link" id="github-link" >üìö GitHub</a></h2><h2><a href="https://www.npmjs.com/package/j-bitcoin" target="_blank" class="menu-item npm-link" id="npm-link" >üì¶ NPM</a></h2><h2><a href="https://github.com/yfbsei/J-Bitcoin/tree/main/examples" target="_blank" class="menu-item examples-link" id="examples-link" >üîß Examples</a></h2><h2><a href="https://github.com/yfbsei/J-Bitcoin/blob/main/CHANGELOG.md" target="_blank" class="menu-item changelog-link" id="changelog-link" >üìä Changelog</a></h2><h3>Global</h3><ul><li><a href="global.html#BIP_COMPLIANCE">BIP_COMPLIANCE</a></li><li><a href="global.html#FEATURES">FEATURES</a></li><li><a href="global.html#LIBRARY_INFO">LIBRARY_INFO</a></li><li><a href="global.html#NETWORKS">NETWORKS</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">src/encoding/address/decode.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @fileoverview Bitcoin address and key decoding utilities
 * @version 2.1.0
 * @author yfbsei
 * @license ISC
 */

import { b58decode } from '../base58.js';
import { decodeSegwit } from '../base32.js';
import { NETWORK_VERSIONS, CRYPTO_CONSTANTS } from '../../core/constants.js';

class DecodingError extends Error {
  constructor(message, code, details = {}) {
    super(message);
    this.name = 'DecodingError';
    this.code = code;
    this.details = details;
  }
}

function decodeWIFPrivateKey(wif) {
  if (typeof wif !== 'string') {
    throw new DecodingError('WIF must be a string', 'INVALID_TYPE');
  }

  const decoded = b58decode(wif);

  if (decoded.length !== 33 &amp;&amp; decoded.length !== 34) {
    throw new DecodingError(
      `Invalid WIF length: ${decoded.length}`,
      'INVALID_LENGTH'
    );
  }

  const versionByte = decoded[0];
  let network, compressed;

  if (versionByte === NETWORK_VERSIONS.main.versions.WIF_PRIVATE_KEY) {
    network = 'main';
  } else if (versionByte === NETWORK_VERSIONS.test.versions.WIF_PRIVATE_KEY) {
    network = 'test';
  } else {
    throw new DecodingError('Invalid WIF version byte', 'INVALID_VERSION');
  }

  if (decoded.length === 34) {
    if (decoded[33] !== 0x01) {
      throw new DecodingError('Invalid compression flag', 'INVALID_COMPRESSION');
    }
    compressed = true;
  } else {
    compressed = false;
  }

  const privateKey = decoded.slice(1, 33);

  return {
    privateKey,
    network,
    compressed
  };
}

function decodeLegacyAddress(address) {
  if (typeof address !== 'string') {
    throw new DecodingError('Address must be a string', 'INVALID_TYPE');
  }

  const decoded = b58decode(address);

  if (decoded.length !== 21) {
    throw new DecodingError(
      `Invalid address length: ${decoded.length}`,
      'INVALID_LENGTH'
    );
  }

  const versionByte = decoded[0];
  const hash160 = decoded.slice(1, 21);

  let network, type;

  if (versionByte === NETWORK_VERSIONS.main.versions.P2PKH_ADDRESS) {
    network = 'main';
    type = 'p2pkh';
  } else if (versionByte === NETWORK_VERSIONS.main.versions.P2SH_ADDRESS) {
    network = 'main';
    type = 'p2sh';
  } else if (versionByte === NETWORK_VERSIONS.test.versions.P2PKH_ADDRESS) {
    network = 'test';
    type = 'p2pkh';
  } else if (versionByte === NETWORK_VERSIONS.test.versions.P2SH_ADDRESS) {
    network = 'test';
    type = 'p2sh';
  } else {
    throw new DecodingError('Unknown address version', 'UNKNOWN_VERSION');
  }

  return {
    hash160,
    network,
    type,
    version: versionByte
  };
}

function decodeSegwitAddress(address) {
  const lowerAddr = address.toLowerCase();
  let hrp;

  if (lowerAddr.startsWith('bc1')) {
    hrp = 'bc';
  } else if (lowerAddr.startsWith('tb1')) {
    hrp = 'tb';
  } else {
    throw new DecodingError('Invalid segwit address prefix', 'INVALID_PREFIX');
  }

  const result = decodeSegwit(hrp, lowerAddr);
  const network = hrp === 'bc' ? 'main' : 'test';

  let type;
  if (result.version === 0) {
    type = result.program.length === 20 ? 'p2wpkh' : 'p2wsh';
  } else if (result.version === 1) {
    type = 'p2tr';
  } else {
    type = `witness_v${result.version}`;
  }

  return {
    program: result.program,
    version: result.version,
    network,
    type
  };
}

function decodeAddress(address) {
  if (typeof address !== 'string' || address.length === 0) {
    throw new DecodingError('Address must be a non-empty string', 'INVALID_ADDRESS');
  }

  const lowerAddr = address.toLowerCase();

  if (lowerAddr.startsWith('bc1') || lowerAddr.startsWith('tb1')) {
    return decodeSegwitAddress(address);
  }

  return decodeLegacyAddress(address);
}

function decodeExtendedKey(extendedKey) {
  if (typeof extendedKey !== 'string') {
    throw new DecodingError('Extended key must be a string', 'INVALID_TYPE');
  }

  const decoded = b58decode(extendedKey);

  if (decoded.length !== 78) {
    throw new DecodingError(
      `Invalid extended key length: ${decoded.length}`,
      'INVALID_LENGTH'
    );
  }

  const version = decoded.slice(0, 4);
  const depth = decoded.readUInt8(4);
  const parentFingerprint = decoded.slice(5, 9);
  const childIndex = decoded.readUInt32BE(9);
  const chainCode = decoded.slice(13, 45);
  const keyData = decoded.slice(45, 78);

  let isPrivate = false;
  let network = 'main';

  if (version.equals(NETWORK_VERSIONS.main.versions.EXTENDED_PRIVATE_KEY)) {
    isPrivate = true;
    network = 'main';
  } else if (version.equals(NETWORK_VERSIONS.main.versions.EXTENDED_PUBLIC_KEY)) {
    isPrivate = false;
    network = 'main';
  } else if (version.equals(NETWORK_VERSIONS.test.versions.EXTENDED_PRIVATE_KEY)) {
    isPrivate = true;
    network = 'test';
  } else if (version.equals(NETWORK_VERSIONS.test.versions.EXTENDED_PUBLIC_KEY)) {
    isPrivate = false;
    network = 'test';
  } else {
    throw new DecodingError('Unknown extended key version', 'UNKNOWN_VERSION');
  }

  let key;
  if (isPrivate) {
    if (keyData[0] !== 0x00) {
      throw new DecodingError('Invalid private key padding', 'INVALID_PADDING');
    }
    key = keyData.slice(1);
  } else {
    key = keyData;
  }

  return {
    version,
    depth,
    parentFingerprint,
    childIndex,
    chainCode,
    key,
    isPrivate,
    network
  };
}

export {
  DecodingError,
  decodeWIFPrivateKey,
  decodeLegacyAddress,
  decodeSegwitAddress,
  decodeAddress,
  decodeExtendedKey
};
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.5</a> on Tue Dec 30 2025 14:53:38 GMT-0500 (Eastern Standard Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>


<script src="scripts/collapse.js" defer></script>


</body>
</html>
