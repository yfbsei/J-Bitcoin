<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>src/encoding/address/encode.js - J-Bitcoin - Bitcoin Wallet Library</title>
    
    <meta name="description" content="JavaScript/TypeScript Bitcoin wallet library with HD wallets, threshold signatures, and BIP compliance" />
    
        <meta name="keywords" content="bitcoin, btc, cryptocurrency, wallet, javascript, typescript, threshold signatures, bip32, bip39" />
        <meta name="keyword" content="bitcoin, btc, cryptocurrency, wallet, javascript, typescript, threshold signatures, bip32, bip39" />
    
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav class="wrap">
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    
    <h2><a href="index.html">Home</a></h2><h2><a href="https://github.com/yfbsei/J-Bitcoin" target="_blank" class="menu-item home-link" id="home-link" >üè† Home</a></h2><h2><a href="https://github.com/yfbsei/J-Bitcoin" target="_blank" class="menu-item github-link" id="github-link" >üìö GitHub</a></h2><h2><a href="https://www.npmjs.com/package/j-bitcoin" target="_blank" class="menu-item npm-link" id="npm-link" >üì¶ NPM</a></h2><h2><a href="https://github.com/yfbsei/J-Bitcoin/tree/main/examples" target="_blank" class="menu-item examples-link" id="examples-link" >üîß Examples</a></h2><h2><a href="https://github.com/yfbsei/J-Bitcoin/blob/main/CHANGELOG.md" target="_blank" class="menu-item changelog-link" id="changelog-link" >üìä Changelog</a></h2><h3>Global</h3><ul><li><a href="global.html#BIP_COMPLIANCE">BIP_COMPLIANCE</a></li><li><a href="global.html#FEATURES">FEATURES</a></li><li><a href="global.html#LIBRARY_INFO">LIBRARY_INFO</a></li><li><a href="global.html#NETWORKS">NETWORKS</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">src/encoding/address/encode.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @fileoverview Bitcoin address and key encoding utilities
 * @version 2.1.0
 * @author yfbsei
 * @license ISC
 */

import { createHash } from 'node:crypto';
import { b58encode } from '../base58.js';
import rmd160 from '../../core/crypto/hash/ripemd160.js';
import { NETWORK_VERSIONS, CRYPTO_CONSTANTS } from '../../core/constants.js';

class EncodingError extends Error {
  constructor(message, code, details = {}) {
    super(message);
    this.name = 'EncodingError';
    this.code = code;
    this.details = details;
  }
}

function hash160(data) {
  const sha256 = createHash('sha256').update(data).digest();
  return rmd160(sha256);
}

function encodeAddress(versionByte, hash160Data) {
  if (!Buffer.isBuffer(hash160Data) &amp;&amp; !(hash160Data instanceof Uint8Array)) {
    throw new EncodingError('Hash160 data must be a Buffer', 'INVALID_TYPE');
  }

  if (hash160Data.length !== CRYPTO_CONSTANTS.HASH160_LENGTH) {
    throw new EncodingError(
      `Hash160 must be ${CRYPTO_CONSTANTS.HASH160_LENGTH} bytes`,
      'INVALID_LENGTH'
    );
  }

  const payload = Buffer.concat([
    Buffer.from([versionByte]),
    Buffer.from(hash160Data)
  ]);

  return b58encode(payload);
}

function encodeP2PKH(publicKey, network = 'main') {
  const pubKeyBuffer = Buffer.isBuffer(publicKey)
    ? publicKey
    : Buffer.from(publicKey, 'hex');

  if (pubKeyBuffer.length !== 33 &amp;&amp; pubKeyBuffer.length !== 65) {
    throw new EncodingError('Invalid public key length', 'INVALID_LENGTH');
  }

  const hash = hash160(pubKeyBuffer);
  const versionByte = network === 'main'
    ? NETWORK_VERSIONS.main.versions.P2PKH_ADDRESS
    : NETWORK_VERSIONS.test.versions.P2PKH_ADDRESS;

  return encodeAddress(versionByte, hash);
}

function encodeP2SH(scriptHash, network = 'main') {
  const hashBuffer = Buffer.isBuffer(scriptHash)
    ? scriptHash
    : Buffer.from(scriptHash, 'hex');

  if (hashBuffer.length !== CRYPTO_CONSTANTS.HASH160_LENGTH) {
    throw new EncodingError('Script hash must be 20 bytes', 'INVALID_LENGTH');
  }

  const versionByte = network === 'main'
    ? NETWORK_VERSIONS.main.versions.P2SH_ADDRESS
    : NETWORK_VERSIONS.test.versions.P2SH_ADDRESS;

  return encodeAddress(versionByte, hashBuffer);
}

function encodeWIF(privateKey, network = 'main', compressed = true) {
  const keyBuffer = Buffer.isBuffer(privateKey)
    ? privateKey
    : Buffer.from(privateKey, 'hex');

  if (keyBuffer.length !== CRYPTO_CONSTANTS.PRIVATE_KEY_LENGTH) {
    throw new EncodingError(
      `Private key must be ${CRYPTO_CONSTANTS.PRIVATE_KEY_LENGTH} bytes`,
      'INVALID_LENGTH'
    );
  }

  const versionByte = network === 'main'
    ? NETWORK_VERSIONS.main.versions.WIF_PRIVATE_KEY
    : NETWORK_VERSIONS.test.versions.WIF_PRIVATE_KEY;

  let payload;
  if (compressed) {
    payload = Buffer.concat([
      Buffer.from([versionByte]),
      keyBuffer,
      Buffer.from([0x01])
    ]);
  } else {
    payload = Buffer.concat([
      Buffer.from([versionByte]),
      keyBuffer
    ]);
  }

  return b58encode(payload);
}

function publicKeyToHash160(publicKey) {
  const pubKeyBuffer = Buffer.isBuffer(publicKey)
    ? publicKey
    : Buffer.from(publicKey, 'hex');

  return hash160(pubKeyBuffer);
}

function scriptToHash160(script) {
  const scriptBuffer = Buffer.isBuffer(script)
    ? script
    : Buffer.from(script, 'hex');

  return hash160(scriptBuffer);
}

function scriptToSHA256(script) {
  const scriptBuffer = Buffer.isBuffer(script)
    ? script
    : Buffer.from(script, 'hex');

  return createHash('sha256').update(scriptBuffer).digest();
}

export {
  EncodingError,
  hash160,
  encodeAddress,
  encodeP2PKH,
  encodeP2SH,
  encodeWIF,
  publicKeyToHash160,
  scriptToHash160,
  scriptToSHA256
};
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.5</a> on Tue Dec 30 2025 14:53:38 GMT-0500 (Eastern Standard Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>


<script src="scripts/collapse.js" defer></script>


</body>
</html>
