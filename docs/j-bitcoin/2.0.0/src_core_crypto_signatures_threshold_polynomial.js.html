<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>src/core/crypto/signatures/threshold/polynomial.js - J-Bitcoin - Bitcoin Wallet Library</title>
    
    <meta name="description" content="JavaScript/TypeScript Bitcoin wallet library with HD wallets, threshold signatures, and BIP compliance" />
    
        <meta name="keywords" content="bitcoin, btc, cryptocurrency, wallet, javascript, typescript, threshold signatures, bip32, bip39" />
        <meta name="keyword" content="bitcoin, btc, cryptocurrency, wallet, javascript, typescript, threshold signatures, bip32, bip39" />
    
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav class="wrap">
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    
    <h2><a href="index.html">Home</a></h2><h2><a href="https://github.com/yfbsei/J-Bitcoin" target="_blank" class="menu-item home-link" id="home-link" >üè† Home</a></h2><h2><a href="https://github.com/yfbsei/J-Bitcoin" target="_blank" class="menu-item github-link" id="github-link" >üìö GitHub</a></h2><h2><a href="https://www.npmjs.com/package/j-bitcoin" target="_blank" class="menu-item npm-link" id="npm-link" >üì¶ NPM</a></h2><h2><a href="https://github.com/yfbsei/J-Bitcoin/tree/main/examples" target="_blank" class="menu-item examples-link" id="examples-link" >üîß Examples</a></h2><h2><a href="https://github.com/yfbsei/J-Bitcoin/blob/main/CHANGELOG.md" target="_blank" class="menu-item changelog-link" id="changelog-link" >üìä Changelog</a></h2><h3>Global</h3><ul><li><a href="global.html#BIP_COMPLIANCE">BIP_COMPLIANCE</a></li><li><a href="global.html#FEATURES">FEATURES</a></li><li><a href="global.html#LIBRARY_INFO">LIBRARY_INFO</a></li><li><a href="global.html#NETWORKS">NETWORKS</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">src/core/crypto/signatures/threshold/polynomial.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @fileoverview Polynomial operations for threshold cryptography
 * @version 2.1.0
 * @author yfbsei
 * @license ISC
 */

import { randomBytes } from 'node:crypto';
import BN from 'bn.js';
import { CRYPTO_CONSTANTS } from '../../../constants.js';

const CURVE_ORDER = new BN(CRYPTO_CONSTANTS.SECP256K1_ORDER, 'hex');

class PolynomialError extends Error {
  constructor(message, code, details = {}) {
    super(message);
    this.name = 'PolynomialError';
    this.code = code;
    this.details = details;
  }
}

function generateSecureRandom(bytes = 32) {
  const buffer = randomBytes(bytes);
  return new BN(buffer).umod(CURVE_ORDER);
}

class Polynomial {
  constructor(degree, secret = null) {
    if (typeof degree !== 'number' || degree &lt; 0) {
      throw new PolynomialError('Degree must be a non-negative integer', 'INVALID_DEGREE');
    }

    this.degree = degree;
    this.coefficients = [];

    if (secret !== null) {
      this.coefficients[0] = secret instanceof BN ? secret : new BN(secret);
    } else {
      this.coefficients[0] = generateSecureRandom();
    }

    for (let i = 1; i &lt;= degree; i++) {
      this.coefficients[i] = generateSecureRandom();
    }
  }

  evaluate(x) {
    if (x === 0 || (x instanceof BN &amp;&amp; x.isZero())) {
      throw new PolynomialError('Cannot evaluate at x=0', 'INVALID_X');
    }

    const xBN = x instanceof BN ? x : new BN(x);
    let result = new BN(0);
    let xPower = new BN(1);

    for (let i = 0; i &lt;= this.degree; i++) {
      const term = this.coefficients[i].mul(xPower).umod(CURVE_ORDER);
      result = result.add(term).umod(CURVE_ORDER);
      xPower = xPower.mul(xBN).umod(CURVE_ORDER);
    }

    return result;
  }

  getSecret() {
    return this.coefficients[0].clone();
  }

  getCoefficients() {
    return this.coefficients.map(c => c.clone());
  }

  generateShares(n) {
    if (n &lt;= this.degree) {
      throw new PolynomialError(
        `Need more participants (${n}) than polynomial degree (${this.degree})`,
        'INSUFFICIENT_PARTICIPANTS'
      );
    }

    const shares = [];
    for (let i = 1; i &lt;= n; i++) {
      shares.push({
        x: new BN(i),
        y: this.evaluate(i),
        index: i
      });
    }

    return shares;
  }

  static lagrangeCoefficient(i, xCoords, x = new BN(0)) {
    let numerator = new BN(1);
    let denominator = new BN(1);

    const xi = xCoords[i] instanceof BN ? xCoords[i] : new BN(xCoords[i]);

    for (let j = 0; j &lt; xCoords.length; j++) {
      if (i === j) continue;

      const xj = xCoords[j] instanceof BN ? xCoords[j] : new BN(xCoords[j]);

      numerator = numerator.mul(x.sub(xj)).umod(CURVE_ORDER);
      denominator = denominator.mul(xi.sub(xj)).umod(CURVE_ORDER);
    }

    const denominatorInv = denominator.invm(CURVE_ORDER);
    return numerator.mul(denominatorInv).umod(CURVE_ORDER);
  }

  static interpolate(shares, x = new BN(0)) {
    if (!Array.isArray(shares) || shares.length === 0) {
      throw new PolynomialError('Shares array is required', 'INVALID_SHARES');
    }

    const xCoords = shares.map(s => s.x instanceof BN ? s.x : new BN(s.x));

    let result = new BN(0);

    for (let i = 0; i &lt; shares.length; i++) {
      const yi = shares[i].y instanceof BN ? shares[i].y : new BN(shares[i].y);
      const li = this.lagrangeCoefficient(i, xCoords, x);
      const term = yi.mul(li).umod(CURVE_ORDER);
      result = result.add(term).umod(CURVE_ORDER);
    }

    return result;
  }

  static reconstructSecret(shares) {
    return this.interpolate(shares, new BN(0));
  }

  static add(poly1, poly2) {
    const maxDegree = Math.max(poly1.degree, poly2.degree);
    const result = new Polynomial(maxDegree, new BN(0));

    for (let i = 0; i &lt;= maxDegree; i++) {
      const c1 = i &lt;= poly1.degree ? poly1.coefficients[i] : new BN(0);
      const c2 = i &lt;= poly2.degree ? poly2.coefficients[i] : new BN(0);
      result.coefficients[i] = c1.add(c2).umod(CURVE_ORDER);
    }

    return result;
  }

  static multiply(poly1, poly2) {
    const newDegree = poly1.degree + poly2.degree;
    const result = new Polynomial(newDegree, new BN(0));

    for (let i = 0; i &lt;= newDegree; i++) {
      result.coefficients[i] = new BN(0);
    }

    for (let i = 0; i &lt;= poly1.degree; i++) {
      for (let j = 0; j &lt;= poly2.degree; j++) {
        const term = poly1.coefficients[i].mul(poly2.coefficients[j]).umod(CURVE_ORDER);
        result.coefficients[i + j] = result.coefficients[i + j].add(term).umod(CURVE_ORDER);
      }
    }

    return result;
  }

  clear() {
    for (let i = 0; i &lt; this.coefficients.length; i++) {
      this.coefficients[i] = new BN(0);
    }
    this.coefficients = [];
    this.degree = 0;
  }
}

export { Polynomial, PolynomialError, generateSecureRandom, CURVE_ORDER };
export default Polynomial;
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.5</a> on Tue Dec 30 2025 14:53:38 GMT-0500 (Eastern Standard Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>


<script src="scripts/collapse.js" defer></script>


</body>
</html>
