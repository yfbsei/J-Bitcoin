<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>src/encoding/base58.js - J-Bitcoin - Bitcoin Wallet Library</title>
    
    <meta name="description" content="JavaScript/TypeScript Bitcoin wallet library with HD wallets, threshold signatures, and BIP compliance" />
    
        <meta name="keywords" content="bitcoin, btc, cryptocurrency, wallet, javascript, typescript, threshold signatures, bip32, bip39" />
        <meta name="keyword" content="bitcoin, btc, cryptocurrency, wallet, javascript, typescript, threshold signatures, bip32, bip39" />
    
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav class="wrap">
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    
    <h2><a href="index.html">Home</a></h2><h2><a href="https://github.com/yfbsei/J-Bitcoin" target="_blank" class="menu-item home-link" id="home-link" >üè† Home</a></h2><h2><a href="https://github.com/yfbsei/J-Bitcoin" target="_blank" class="menu-item github-link" id="github-link" >üìö GitHub</a></h2><h2><a href="https://www.npmjs.com/package/j-bitcoin" target="_blank" class="menu-item npm-link" id="npm-link" >üì¶ NPM</a></h2><h2><a href="https://github.com/yfbsei/J-Bitcoin/tree/main/examples" target="_blank" class="menu-item examples-link" id="examples-link" >üîß Examples</a></h2><h2><a href="https://github.com/yfbsei/J-Bitcoin/blob/main/CHANGELOG.md" target="_blank" class="menu-item changelog-link" id="changelog-link" >üìä Changelog</a></h2><h3>Global</h3><ul><li><a href="global.html#BIP_COMPLIANCE">BIP_COMPLIANCE</a></li><li><a href="global.html#FEATURES">FEATURES</a></li><li><a href="global.html#LIBRARY_INFO">LIBRARY_INFO</a></li><li><a href="global.html#NETWORKS">NETWORKS</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">src/encoding/base58.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @fileoverview Base58Check encoding implementation for Bitcoin
 * @version 2.1.0
 * @author yfbsei
 * @license ISC
 */

import { createHash, timingSafeEqual } from 'node:crypto';

const BASE58_ALPHABET = '123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz';
const CHECKSUM_LENGTH = 4;

function doubleHash256(data) {
  return createHash('sha256').update(createHash('sha256').update(data).digest()).digest();
}

function encode(buffer) {
  if (!Buffer.isBuffer(buffer)) {
    throw new Error('Input must be a Buffer');
  }

  if (buffer.length === 0) {
    return '';
  }

  let leadingZeros = 0;
  for (let i = 0; i &lt; buffer.length &amp;&amp; buffer[i] === 0; i++) {
    leadingZeros++;
  }

  let num = BigInt(0);
  for (let i = leadingZeros; i &lt; buffer.length; i++) {
    num = num * BigInt(256) + BigInt(buffer[i]);
  }

  const result = [];
  if (num === BigInt(0)) {
    result.push(BASE58_ALPHABET[0]);
  } else {
    while (num > 0) {
      const remainder = num % BigInt(58);
      num = num / BigInt(58);
      result.unshift(BASE58_ALPHABET[Number(remainder)]);
    }
  }

  return '1'.repeat(leadingZeros) + result.join('');
}

function decode(str) {
  if (typeof str !== 'string') {
    throw new Error('Input must be a string');
  }

  if (str.length === 0) {
    return Buffer.alloc(0);
  }

  let leadingOnes = 0;
  for (let i = 0; i &lt; str.length &amp;&amp; str[i] === '1'; i++) {
    leadingOnes++;
  }

  let num = BigInt(0);
  for (let i = leadingOnes; i &lt; str.length; i++) {
    const char = str[i];
    const index = BASE58_ALPHABET.indexOf(char);
    if (index === -1) {
      throw new Error(`Invalid Base58 character: ${char}`);
    }
    num = num * BigInt(58) + BigInt(index);
  }

  const bytes = [];
  if (num === BigInt(0)) {
    bytes.push(0);
  } else {
    while (num > 0) {
      const remainder = num % BigInt(256);
      num = num / BigInt(256);
      bytes.unshift(Number(remainder));
    }
  }

  const leadingZeros = new Array(leadingOnes).fill(0);
  return Buffer.from([...leadingZeros, ...bytes]);
}

function b58encode(buffer) {
  if (!Buffer.isBuffer(buffer)) {
    throw new Error('Input must be a Buffer');
  }

  const checksum = doubleHash256(buffer).slice(0, CHECKSUM_LENGTH);
  const checkedBuf = Buffer.concat([buffer, checksum]);
  const encoded = encode(checkedBuf);

  let leadingZeros = 0;
  for (let i = 0; i &lt; buffer.length &amp;&amp; buffer[i] === 0; i++) {
    leadingZeros++;
  }

  let decodedLeadingOnes = 0;
  for (let i = 0; i &lt; encoded.length &amp;&amp; encoded[i] === '1'; i++) {
    decodedLeadingOnes++;
  }

  if (decodedLeadingOnes !== leadingZeros) {
    throw new Error(
      `Leading zero preservation failed: expected ${leadingZeros} '1' chars, got ${decodedLeadingOnes}`
    );
  }

  return encoded;
}

function b58decode(encoded) {
  if (typeof encoded !== 'string') {
    throw new Error('Input must be a string');
  }

  const decoded = decode(encoded);

  if (decoded.length &lt; CHECKSUM_LENGTH) {
    throw new Error('Decoded data too short for checksum verification');
  }

  const data = decoded.slice(0, -CHECKSUM_LENGTH);
  const providedChecksum = decoded.slice(-CHECKSUM_LENGTH);
  const expectedChecksum = doubleHash256(data).slice(0, CHECKSUM_LENGTH);

  if (!providedChecksum.equals(expectedChecksum)) {
    throw new Error('Checksum verification failed');
  }

  return data;
}

function encodeBase58Check(data) {
  return b58encode(data);
}

function decodeBase58Check(encoded) {
  return b58decode(encoded);
}

export { b58encode, b58decode, encode, decode, encodeBase58Check, decodeBase58Check };
export default { b58encode, b58decode, encode, decode, encodeBase58Check, decodeBase58Check };
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.5</a> on Tue Dec 30 2025 14:53:38 GMT-0500 (Eastern Standard Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>


<script src="scripts/collapse.js" defer></script>


</body>
</html>
